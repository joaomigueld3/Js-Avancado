<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullet Penetration Simulation</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/dist/p5.js"></script>
    <script src="https://unpkg.com/@dimforge/rapier2d@0.11.1/dist/rapier2d.js"></script>
</head>
<body>
    <script>
        let world;
        let bullet;
        let wall;
        let velocity = 500;
        let wallThickness = 30;

        function setup() {
            createCanvas(800, 600);
            world = new RAPIER.World({ x: 0, y: 9.81 });
            createBullet();
            createWall();
            createSliders();
        }

        function draw() {
            background(220);
            world.step();
            drawBullet();
            drawWall();
        }

        function createBullet() {
            const body = world.createRigidBody({
                type: RAPIER.RigidBodyType.Dynamic,
                position: new RAPIER.Vector2(0, 0),
                rotation: 0,
                linvel: new RAPIER.Vector2(velocity / 100, 0),
                angvel: 0,
                mass: 0.008,
            });
            const shape = new RAPIER.ColliderDesc.RoundConvexPolygon([new RAPIER.Vector2(0.0045, 0)], 0);
            shape.setActiveEvents(RAPIER.ActiveEvents.COLLISION_EVENTS);
            shape.setCollisionGroups(0xffffffff);
            shape.setContactForceEventThreshold(0);
            world.createCollider(shape, body);
            bullet = body;
        }

        function createWall() {
            const body = world.createRigidBody({
                type: RAPIER.RigidBodyType.Static,
                position: new RAPIER.Vector2(10, 0),
                rotation: 0,
            });
            const shape = new RAPIER.ColliderDesc.Cuboid(wallThickness / 100 / 2, 1);
            shape.setActiveEvents(RAPIER.ActiveEvents.COLLISION_EVENTS);
            shape.setCollisionGroups(0xffffffff);
            shape.setContactForceEventThreshold(0);
            world.createCollider(shape, body);
            wall = body;
        }

        function drawBullet() {
            const pos = bullet.translation();
            ellipse(pos.x * 100, pos.y * 100, 9);
        }

        function drawWall() {
            const pos = wall.translation();
            rect(pos.x * 100 - wallThickness / 2, pos.y * 100 - 50, wallThickness, 100);
        }

        function createSliders() {
            const velocitySlider = createSlider(100, 1000, velocity);
            velocitySlider.position(10, 10);
            velocitySlider.size(200);
            velocitySlider.input(() => {
                velocity = velocitySlider.value();
                bullet.setLinvel(new RAPIER.Vector2(velocity / 100, bullet.linvel().y), true);
            });

            const wallThicknessSlider = createSlider(10, 50, wallThickness);
            wallThicknessSlider.position(10, 50);
            wallThicknessSlider.size(200);
            wallThicknessSlider.input(() => {
                wallThickness = wallThicknessSlider.value();
                world.removeCollider(wall.colliders()[0], true);
                const shape = new RAPIER.ColliderDesc.Cuboid(wallThickness / 100 / 2, 1);
                shape.setActiveEvents(RAPIER.ActiveEvents.COLLISION_EVENTS);
                shape.setCollisionGroups(0xffffffff);
                shape.setContactForceEventThreshold(0);
                world.createCollider(shape, wall);
            });
        }
    </script>
</body>
</html>